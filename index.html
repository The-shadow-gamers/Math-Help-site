<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Math Help</title>

<!-- Favicons / Cloaking -->
<link rel="icon" type="image/png" sizes="16x16" href="down-favicon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="down-favicon-32.png">
<link rel="icon" type="image/png" sizes="64x64" href="down-favicon-64.png">

<style>
  :root{
    --bar-h: 48px;
    --bg: #0b1220;
    --panel: #121a2e;
    --panel-2: #0f1628;
    --fg: #e6edf3;
    --muted: #90a4b4;
    --accent: #3281ff;
    --accent-2:#009cff;
    --ok:#2ecc71;
    --warn:#f39c12;
    --danger:#e74c3c;
    --radius: 14px;
    --shadow: 0 8px 24px rgba(0,0,0,.35);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font: 14px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  }

  /* Top bar */
  .topbar{
    position:fixed; inset:0 0 auto 0; height:var(--bar-h);
    display:flex; align-items:center; gap:10px; padding:0 10px;
    background:#0f172a; border-bottom:1px solid #0b1220;
    z-index:50;
  }
  .brand{font-weight:700; letter-spacing:.3px}
  .spacer{flex:1}

  /* Buttons */
  .btn{
    background:var(--accent);
    color:#fff; border:0; border-radius:10px;
    padding:8px 12px; font-weight:700; cursor:pointer;
    box-shadow: var(--shadow);
  }
  .btn:hover{ background:var(--accent-2) }
  .btn.ghost{ background:#172036; color:#dbe7ff; border:1px solid #1b2742; box-shadow:none }
  .btn.ghost:hover{ background:#1a2542 }

  /* Layout */
  .wrap{ position:fixed; inset:var(--bar-h) 0 0 0; display:grid; grid-template-rows:auto 1fr }
  .menu{
    display:flex; align-items:center; gap:8px; padding:8px 10px;
    background:#0e1527; border-bottom:1px solid #0b1220;
  }

  /* Games row (second row with game buttons) */
  .games-row{ display:flex; align-items:center; gap:8px; padding:8px 10px; background:#0e1527; border-bottom:1px solid #0b1220 }

  /* Embedded main frame */
  .embed{
    width:100%; height:100%; border:0; background:#0b1220;
  }

  /* Drawer / Tools / Terminal / Browser panels */
  .drawer{ position:fixed; top:var(--bar-h); left:0; right:0; height:auto; z-index:40; display:none }
  .drawer.open{ display:block }
  .panel{
    margin:10px; background:var(--panel); border:1px solid #1b2742;
    border-radius:var(--radius); box-shadow:var(--shadow);
  }
  .panel-h{
    display:flex; align-items:center; justify-content:space-between;
    padding:10px 12px; border-bottom:1px solid #1b2742;
    background:#0f1628; border-radius:var(--radius) var(--radius) 0 0;
  }
  .panel-b{ padding:10px 12px }

  /* Tools */
  .tools-grid{ display:grid; grid-template-columns:repeat(3, minmax(220px, 1fr)); gap:10px }
  .tool{ background:#111a30; border:1px solid #1b2742; border-radius:12px; padding:8px }
  .tool h4{ margin:6px 0 8px 0 }
  .tool textarea, .tool input{
    width:100%; background:#0e162a; color:var(--fg); border:1px solid #213155;
    border-radius:10px; padding:8px; resize:vertical;
  }

  /* Terminal */
  #terminal{ background:#0b1220; border:1px solid #1b2742; border-radius:12px; padding:10px; height:260px; overflow:auto; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,"Liberation Mono","Courier New",monospace }
  #termOut pre{ margin:0; white-space:pre-wrap; word-break:break-word }
  #termIn{ width:100%; margin-top:8px; background:#0e162a; color:var(--fg); border:1px solid #213155; border-radius:10px; padding:8px }

  /* Mini-browser */
  #browserWrap{ display:none }
  #miniBrowser{ width:100%; height:420px; border:0; background:#000 }
  .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .row select{ background:#0f1628; color:#fff; border:1px solid #213155; border-radius:8px; padding:6px 10px }
  .row input[type="text"]{ background:#0f1628; color:#fff; border:1px solid #213155; border-radius:8px; padding:6px 10px; flex:1 }

  /* Hidden hotspot */
  #hotspot{ position:fixed; top:0; left:0; width:56px; height:56px; z-index:60; background:transparent }

  /* Collapsible menu */
  #collapseBtn{ background:#172036 }
  .collapsed .menu, .collapsed .games-row{ display:none }
  .collapsed .wrap{ grid-template-rows:1fr }

  /* Simple toast */
  .toast{ position:fixed; right:12px; bottom:12px; background:#172036; color:#dbe7ff; border:1px solid #1b2742; border-radius:10px; padding:10px 12px; opacity:0; transform:translateY(10px); transition:all .25s ease; z-index:60 }
  .toast.show{ opacity:1; transform:none }
</style>
</head>
<body>

<!-- Invisible unlock hotspot (top-left) -->
<div id="hotspot" title="Hotspot"></div>

<!-- Top bar -->
<div class="topbar">
  <div class="brand">Math Help</div>
  <div class="spacer"></div>

  <!-- Panic button lives here for quick access -->
  <button id="panicTop" class="btn ghost" title="Quick Panic">Panic</button>
  <button id="collapseBtn" class="btn">Close Menu</button>
</div>

<div class="wrap" id="appRoot">

  <!-- First row: main controls -->
  <div class="menu" id="menuRow">
    <!-- Gate/Tab Cloak -->
    <select id="cloakSelect" title="Tab cloak">
      <option value='{"title":"Math Help - Down","icon":"down-favicon-32.png"}'>Math Help</option>
      <option value='{"title":"Google","icon":"google-favicon.png"}'>Google</option>
      <option value='{"title":"Calculator","icon":"calculator-icon.png"}'>Calculator</option>
      <option value='{"title":"Google Docs","icon":"google-docs-icon.png"}'>Google Docs</option>
      <option value='{"title":"Google Classroom","icon":"classroom-favicon.png"}'>Classroom</option>
      <option value='{"title":"Khan Academy","icon":"khan-favicon.png"}'>Khan Academy</option>
      <option value='{"title":"Wikipedia","icon":"wikipedia-favicon.png"}'>Wikipedia</option>
    </select>

    <button id="panicFire" class="btn">Panic</button>

    <!-- Tools / Browser / Terminal -->
    <button id="toolsBtn" class="btn">Tools</button>
    <button id="openBrowser" class="btn">Browser</button>
    <button id="openTermBtn" class="btn">Terminal</button>
  </div>

  <!-- Second row: Games -->
  <div class="games-row" id="gamesRow">
    <strong>Games:</strong>
    <button id="openBurrito" class="btn">Burrito Bison</button>
    <!-- NEW: Golf Hit button opening in a new tab like Burrito -->
    <button id="openGolfHit" class="btn">Golf Hit</button>
  </div>

  <!-- Embedded main content -->
  <iframe id="mainFrame" class="embed" src="https://mathhelp0g1.netlify.app/" title="Main Content"></iframe>
</div>

<!-- Drawer panels (hidden until opened) -->
<div class="drawer" id="drawer">

  <!-- Tools Panel -->
  <div class="panel" id="toolsPanel" style="display:none">
    <div class="panel-h">
      <div>Tools</div>
      <button class="btn ghost" type="button" id="toolsClose">Close</button>
    </div>
    <div class="panel-b">
      <div class="tools-grid">

        <!-- Notepad -->
        <div class="tool">
          <h4>Notepad</h4>
          <textarea id="noteBox" rows="7" placeholder="Quick notesâ€¦"></textarea>
          <div class="row" style="margin-top:8px">
            <button id="noteSave" class="btn">Save</button>
            <button id="noteClear" class="btn ghost">Clear</button>
          </div>
        </div>

        <!-- Timer -->
        <div class="tool">
          <h4>Timer</h4>
          <div class="row">
            <input id="tMin" type="number" min="0" step="1" placeholder="min">
            <input id="tSec" type="number" min="0" max="59" step="1" placeholder="sec">
            <button id="timerStart" class="btn">Start</button>
            <button id="timerStop" class="btn ghost">Stop</button>
          </div>
          <div style="margin-top:8px"><span id="tLeft">00:00</span></div>
        </div>

        <!-- Unit Converter -->
        <div class="tool">
          <h4>Unit Converter</h4>
          <div class="row">
            <input id="ucInput" type="text" placeholder="e.g., 10 ft to m">
            <button id="ucRun" class="btn">Convert</button>
          </div>
          <div style="margin-top:8px" id="ucOut"></div>
        </div>

      </div>
    </div>
  </div>

  <!-- Mini Browser -->
  <div class="panel" id="browserPanel" style="display:none">
    <div class="panel-h">
      <div>Mini Browser</div>
      <div class="row">
        <button id="browserOpen" class="btn">Open</button>
        <button id="browserClose" class="btn ghost">Close</button>
        <button id="browserHalf" class="btn ghost">Half</button>
        <button id="browserWindow" class="btn ghost">Window</button>
      </div>
    </div>
    <div class="panel-b">
      <div class="row" style="margin-bottom:8px">
        <select id="siteChooser" title="Choose preset">
          <option value='{"title":"Math Help - Down","icon":"down-favicon-32.png"}'>Math Help</option>
          <option value='{"title":"Google","icon":"google-favicon.png"}'>Google</option>
          <option value='{"title":"Calculator","icon":"calculator-icon.png"}'>Calculator</option>
          <option value='{"title":"Google Docs","icon":"google-docs-icon.png"}'>Google Docs</option>
          <option value='{"title":"Google Classroom","icon":"classroom-favicon.png"}'>Classroom</option>
          <option value='{"title":"Khan Academy","icon":"khan-favicon.png"}'>Khan Academy</option>
          <option value='{"title":"Wikipedia","icon":"wikipedia-favicon.png"}'>Wikipedia</option>
        </select>
        <input id="browserURL" type="text" placeholder="https://example.com">
        <button id="browserGo" class="btn">Go</button>
      </div>
      <iframe id="miniBrowser" title="Mini Browser"></iframe>
    </div>
  </div>

  <!-- Terminal -->
  <div class="panel" id="termPanel" style="display:none">
    <div class="panel-h">
      <div>Terminal</div>
      <button id="termClose" class="btn ghost" type="button">Close</button>
    </div>
    <div class="panel-b">
      <div id="terminal">
        <div id="termOut"></div>
        <input id="termIn" type="text" placeholder="Type ;help for commands" />
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  // --- Utilities ---
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const toast = (msg, ms=1600) => {
    const el = $("#toast"); el.textContent = msg; el.classList.add("show");
    setTimeout(()=> el.classList.remove("show"), ms);
  };

  // --- Tab cloak ---
  function setTab(title, icons){
    document.title = title || "Math Help";
    if(icons && typeof icons === "object"){
      const link16 = document.querySelector('link[sizes="16x16"]');
      const link32 = document.querySelector('link[sizes="32x32"]');
      const link64 = document.querySelector('link[sizes="64x64"]');
      if(link16 && icons["16x16"]) link16.href = icons["16x16"];
      if(link32 && icons["32x32"]) link32.href = icons["32x32"];
      if(link64 && icons["64x64"]) link64.href = icons["64x64"];
    }
  }

  $("#cloakSelect").addEventListener("change", e=>{
    try{
      const v = JSON.parse(e.target.value);
      setTab(v.title, {"16x16":v.icon, "32x32":v.icon, "64x64":v.icon});
      toast("Tab updated");
    }catch(err){ /* ignore */ }
  });

  // Initial "down" favicon set (multi-size)
  setTab("Math Help - Down",{"16x16":"down-favicon-16.png","32x32":"down-favicon-32.png","64x64":"down-favicon-64.png"});

  // --- Hotspot (for any secret actions if needed later) ---
  $("#hotspot").addEventListener("click", ()=> {
    document.body.classList.toggle("collapsed");
  });

  // --- Collapsible menu ---
  $("#collapseBtn").addEventListener("click", ()=>{
    document.body.classList.toggle("collapsed");
    $("#collapseBtn").textContent = document.body.classList.contains("collapsed") ? "Open Menu" : "Close Menu";
  });

  // --- Panic key / button ---
  function doPanic(){
    // Clear UI, swap to "safe" title/icon, and navigate away
    setTab("Math Help - Down",{"16x16":"down-favicon-16.png","32x32":"down-favicon-32.png","64x64":"down-favicon-64.png"});
    $("#mainFrame").src = "about:blank";
    window.location.href = "https://www.khanacademy.org/";
  }
  document.addEventListener("keydown", (e)=>{
    if(e.key === "-"){ doPanic(); }
  });
  $("#panicTop").addEventListener("click", doPanic);
  $("#panicFire").addEventListener("click", doPanic);

  // --- Tools drawer ---
  const drawer = $("#drawer");
  const toolsPanel = $("#toolsPanel");
  $("#toolsBtn").addEventListener("click", ()=>{
    drawer.classList.add("open");
    toolsPanel.style.display = "block";
  });
  $("#toolsClose").addEventListener("click", ()=>{
    toolsPanel.style.display = "none";
    if($("#browserPanel").style.display!=="block" && $("#termPanel").style.display!=="block"){
      drawer.classList.remove("open");
    }
  });

  // Notepad
  const noteBox = $("#noteBox");
  const NOTE_KEY = "mh_note";
  noteBox.value = localStorage.getItem(NOTE_KEY) || "";
  $("#noteSave").addEventListener("click", ()=> {
    localStorage.setItem(NOTE_KEY, noteBox.value || "");
    toast("Saved");
  });
  $("#noteClear").addEventListener("click", ()=> {
    noteBox.value = "";
    localStorage.removeItem(NOTE_KEY);
    toast("Cleared");
  });

  // Timer
  let tHandle = null, remain = 0;
  const tLeft = $("#tLeft");
  function fmt(n){ return n<10 ? "0"+n : n; }
  function tick(){
    if(remain<=0){ clearInterval(tHandle); tHandle=null; toast("Timer done"); return; }
    remain--;
    const m = Math.floor(remain/60), s = remain%60;
    tLeft.textContent = `${fmt(m)}:${fmt(s)}`;
  }
  $("#timerStart").addEventListener("click", ()=>{
    const m = parseInt($("#tMin").value||"0",10);
    const s = parseInt($("#tSec").value||"0",10);
    remain = Math.max(0, m*60 + s);
    if(tHandle) clearInterval(tHandle);
    tHandle = setInterval(tick,1000);
    tick();
  });
  $("#timerStop").addEventListener("click", ()=> {
    if(tHandle) clearInterval(tHandle); tHandle=null;
    toast("Timer stopped");
  });

  // Unit converter (very basic)
  function convert(query){
    // expects like "10 ft to m"
    try{
      const parts = query.trim().toLowerCase().split(/\s+/);
      const val = parseFloat(parts[0]);
      if(!isFinite(val)) return "Enter a value, e.g., 10 ft to m";
      const from = parts[1]; const to = parts[3];
      const table = {
        ft:{m:0.3048}, m:{ft:3.28084},
        in:{cm:2.54}, cm:{in:0.3937007874},
        lb:{kg:0.45359237}, kg:{lb:2.2046226218}
      };
      if(table[from] && table[from][to]){
        const out = val * table[from][to];
        return `${val} ${from} â‰ˆ ${out} ${to}`;
      }
      return "Unsupported conversion";
    }catch(e){ return "Invalid format. Try: 10 ft to m"; }
  }
  $("#ucRun").addEventListener("click", ()=>{
    $("#ucOut").textContent = convert($("#ucInput").value || "");
  });

  // --- Mini Browser ---
  const browserPanel = $("#browserPanel");
  const miniBrowser = $("#miniBrowser");
  $("#openBrowser").addEventListener("click", ()=>{
    drawer.classList.add("open");
    browserPanel.style.display = "block";
  });
  $("#browserClose").addEventListener("click", ()=>{
    browserPanel.style.display = "none";
    if($("#toolsPanel").style.display!=="block" && $("#termPanel").style.display!=="block"){
      drawer.classList.remove("open");
    }
  });
  $("#browserOpen").addEventListener("click", ()=>{
    miniBrowser.style.display = "block";
  });
  $("#browserHalf").addEventListener("click", ()=>{
    miniBrowser.style.height = "220px";
  });
  $("#browserWindow").addEventListener("click", ()=>{
    window.open($("#browserURL").value || "about:blank","_blank");
  });
  $("#browserGo").addEventListener("click", ()=>{
    const u = $("#browserURL").value.trim();
    if(!u) { toast("Enter a URL"); return; }
    miniBrowser.src = u;
  });

  // --- Terminal ---
  const termPanel = $("#termPanel");
  $("#openTermBtn").addEventListener("click", ()=>{
    drawer.classList.add("open");
    termPanel.style.display = "block";
  });
  $("#termClose").addEventListener("click", ()=>{
    termPanel.style.display = "none";
    if($("#toolsPanel").style.display!=="block" && $("#browserPanel").style.display!=="block"){
      drawer.classList.remove("open");
    }
  });

  const termOut = $("#termOut");
  const termIn = $("#termIn");
  function termPrint(s){ const pre = document.createElement("pre"); pre.textContent = s; termOut.appendChild(pre); termOut.scrollTop = termOut.scrollHeight; }

  const cmds = {
    ";help": ()=> termPrint("Commands:\n;help ;clear ;panic ;open tools ;close tools ;browser open/close/full/half/window"),
    ";clear": ()=> { termOut.innerHTML=""; },
    ";panic": ()=> doPanic(),
    ";open tools": ()=> { drawer.classList.add("open"); toolsPanel.style.display="block"; },
    ";close tools": ()=> { toolsPanel.style.display="none"; if(browserPanel.style.display!=="block" && termPanel.style.display!=="block"){drawer.classList.remove("open");} },
    ";browser open": ()=> { drawer.classList.add("open"); browserPanel.style.display="block"; },
    ";browser close": ()=> { browserPanel.style.display="none"; if(toolsPanel.style.display!=="block" && termPanel.style.display!=="block"){drawer.classList.remove("open");} },
    ";browser full": ()=> { miniBrowser.style.display="block"; miniBrowser.style.height="420px"; },
    ";browser half": ()=> { miniBrowser.style.display="block"; miniBrowser.style.height="220px"; },
    ";browser window": ()=> { window.open($("#browserURL").value || "about:blank","_blank"); }
  };

  termIn.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      const v = termIn.value.trim();
      if(!v) return;
      termPrint("> " + v);
      if(cmds[v]) cmds[v]();
      else termPrint("Unknown command. Try ;help");
      termIn.value = "";
    }
  });

  // --- Games buttons ---
  const burritoBtn = document.getElementById('openBurrito');
  if (burritoBtn) {
    burritoBtn.addEventListener('click', () => {
      // Keep your original behavior (new tab load)
      window.open('/burrito/index.html', '_blank');
    });
  }

  // NEW: Golf Hit handler (mirrors Burrito Bison behavior; opens in new tab)
  const golfHitBtn = document.getElementById('openGolfHit');
  if (golfHitBtn) {
    golfHitBtn.addEventListener('click', () => {
      window.open('golfhit.html', '_blank');
    });
  }

</script>
</body>
</html>
